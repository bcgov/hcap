kind: Template
apiVersion: v1
labels:
  app: ${APP_NAME}
parameters:
  - name: APP_NAME
    description: App name that OpenShift objects will be prefixed with
    required: true
  - name: REPO
    description: URL of boilerplate repository
    value: https://github.com/bcgov/hcap.git
    required: true
  - name: REF
    description: Git ref of the repository that should be built
    value: origin/master
    required: true
  - name: IMAGE_TAG
    description: ImageStream tag for build and deploy
    value: latest
    required: true
  - name: VERSION
    description: The application version returned by the API version endpoint
    value: VERSION_UNDEFINED
    required: true
objects:
  - kind: ImageStream
    apiVersion: v1
    metadata:
      name: ${APP_NAME}-server
    spec:
      lookupPolicy:
        local: false
  - kind: BuildConfig
    apiVersion: v1
    metadata:
      name: ${APP_NAME}-server
    spec:
      completionDeadlineSeconds: 600
      triggers:
        - type: ImageChange
        - type: ConfigChange
      runPolicy: SerialLatestOnly
      source:
        type: Git
        git:
          uri: ${REPO}
          ref: ${REF}
      strategy:
        dockerStrategy:
          buildArgs:
            - name: VERSION
              value: ${VERSION}
      output:
        to:
          kind: ImageStreamTag
          name: ${APP_NAME}-server:${IMAGE_TAG}
      resources:
        limits:
          cpu: "2"
          memory: 4Gi
